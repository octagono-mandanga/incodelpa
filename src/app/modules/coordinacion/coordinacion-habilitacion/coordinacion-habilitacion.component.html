<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item" aria-current="page"><a routerLink="/coordinacion/cursos">Cursos</a></li>
    <li *ngIf="data?.id" class="breadcrumb-item" aria-current="page"><a [routerLink]="['/coordinacion/cursos/view/', id]">{{ data.nombre }}</a></li>
    <li class="breadcrumb-item active" aria-current="page">Habilitaciones</li>
  </ol>
</nav>
<div class="card" *ngIf="loading">
  <div class="card-body">
    <div class="container mt-3">
      <div class="d-flex justify-content-center">
        <app-loading size="30px"></app-loading>
        <h4 class="ms-2 text-secondary">
          Cargando {{msg}}...
        </h4>
      </div>
    </div>
  </div>
</div>
<div class="row" *ngIf="!loading">

  <div class="col-xs-12 col-md-3">
    <div class="card mb-2" style="background: none;" *ngIf="!loading">
      <div class="card-body">

        <h4 class="card-title mb-0">{{ data.nombre }}</h4>
        <p class="card-text mb-0">
          {{ data.grado.nombre }}
        </p>
        <p class="card-text mb-0">
          {{ data.lectivo.nivel.nombre }}
        </p>
        <p class="card-text mb-0">
          <span class="text-secondary">
            Sede:
          </span>
           {{ data.sede.nombre }}
        </p>
        <p class="card-text mb-0">
          <span class="text-secondary">
            Director:
          </span>
          {{ data.director?.primer_nombre }}
        </p>
        <div>
          <span class="text-secondary">
            Estado:
          </span>
          <i *ngIf="data.estado==='activo'" class="fa-solid fa-circle-check text-success"></i>
          <i *ngIf="data.estado==='inactivo'" class="fa-solid fa-circle-minus text-danger"></i>
        </div>
      </div>
    </div>
    <div class="card bg-light bg-gradient" *ngIf="!loading && disponibles.length>0">
      <div class="card-body p-0 pt-2">
        <small class="ms-3 fw-bold text-secondary">
          Sin Asignar
        </small>
        <!-- Some borders are removed -->
        <div class="disponibles mt-2 mb-2">
            <ul class="list-group list-group-flush">
            <li *ngFor="let item of disponibles" class="list-group-item bg-transparent py-0">
              <small>
                {{ item.nombre | titlecase }}
              </small>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <div class="col-xs-12 col-md-9">
    <div class="card rounded-0 shadow-sm">


      <div class="card-body p-0" *ngIf="!loading">
        <div *ngIf="progress" class="progress" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100" style="height: 5px">
          <div class="progress-bar progress-bar-striped progress-bar-animated" style="width: 50%"></div>
        </div>
        <!---->
        <div class="table-responsive">
          <table class="table table-striped table-bordered">
            <thead>
              <tr>
                <th>Alumno</th>
                <th>Área</th>
                <th class="text-center align-middle">Nota Área</th>
                <th>Asignatura</th>
                <th>Nota</th>
                <th class="text-center align-middle">Habilitación</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let row of tableData; let i = index">
                <!-- Mostrar datos del alumno solo en la primera fila -->
                <td *ngIf="row.alumno" [attr.rowspan]="row.alumnoRowspan" class="align-middle" style="border-bottom: 3px solid #000;">
                  <div class="d-flex">
                    <div class="flex-shrink-0">
                      <img [src]="row.alumno.avatar_url" alt="" width="48px" class="rounded-circle me-2" />
                    </div>
                    <div class="flex-grow-1 ms-3">
                      <p class="h5 my-0 lh-2">
                        {{ row.alumno.primer_apellido }} {{ row.alumno.segundo_apellido }}
                      </p>
                      <p class="h6 fw-normal lh-1 mb-0">
                        {{ row.alumno.primer_nombre }} {{ row.alumno.segundo_nombre }}
                      </p>
                    </div>
                  </div>
                </td>
                <!-- Mostrar datos del área solo en la primera fila de sus asignaturas -->
                <td *ngIf="row.area" [attr.rowspan]="row.areaRowspan" class="align-middle">{{ row.area }}</td>
                <td *ngIf="row.notaArea" [attr.rowspan]="row.areaRowspan" [ngStyle]="{'color': getColor(row.notaArea)}" class="align-middle text-center fw-bold">{{ row.notaArea }}</td>
                <!-- Mostrar asignatura y nota -->
                <td class="align-middle">{{ row.asignatura }}
                  <small>[{{row.asignaturaPorcentaje}}%]
                  </small>
                </td>
                <td class="align-middle text-center fw-bold"  [ngStyle]="{'color': getColor(row.nota)}">{{ row.nota }}</td>
                <!-- Campo editable para habilitación -->
                <td class="align-middle text-center" style="justify-content: center; display: flex;">
                  <div *ngIf="getBajo(row.nota)">
                    <app-coordinacion-habilitacion-item
                    #habilitacionComponent
                    (emitirLaNota)="procesarLaNota($event)"
                    [notafull]="row.habilitacion"
                    [escalas]="escalas"
                    [data]="row"></app-coordinacion-habilitacion-item>
                  </div>
                  <i *ngIf="!getBajo(row.nota)" class="text-muted">Bloqueado</i>
                </td>
              </tr>
            </tbody>
          </table>
        </div>






      </div>
    </div>
  </div>
</div>
